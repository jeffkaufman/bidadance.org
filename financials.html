<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel=stylesheet href=main.css>
<title>BIDA - Financials</title>
</head>
<body>

<div id=banner><div id=logo-wrapper><a href="/"><img src="bida_logo.gif"></a></div></div>
<div id=nav-wrapper><div id=nav><a href="/about">About</a><a href="/get-involved">Get Involved</a><a href="/safety">Safety</a><a href="/faq">FAQ</a><a href="http://blog.bidadance.org/">Blog</a></div></div>

<div id=content>

<h1>Financials</h1>

This shows how all our events have done financially.  It has all our
events, including Spark in the Dark and other special events.

<h2>Income</h2>

This is how much money we received at the door, plus advance tickets
if we did that.

<p>

<div id="income_div" style="width: 100%; height: 400px;"></div>

<h2>BIDA Profit / Loss</h2>

This is the effect of running the dance on BIDA's bank account.  How
much money is left after paying the hall, musicians, caller, sound,
etc?

<p>

One thing that makes things confusing is we have two kinds of profit:

<ul>
<li><b>Raw profit</b>: money left over after paying fixed expenses.  Some of this profit goes to the band and caller.</li>
<li><b>BIDA profit</b>: money BIDA actually gets to keep.  This is raw profit minus profit sharing payments to the performers, and is what we graph here.</li>
</ul>

If you want to understand our financials more, see our <a
href="/payscale">pay scale</a> and <a
href="/attendance-financials-template">financials worksheet</a>.

<p>

<div id="profit_div" style="width: 100%; height: 400px;"></div>

<p>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("visualization", "1", {packages:["corechart"]});
function fetch(url, callback) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState==4 && xhr.status==200) {
      callback(xhr.responseText);
    }
  };
  xhr.open("GET",url,true);
  xhr.send();
}
google.setOnLoadCallback(function () {
  fetch("/financials.log", function(response) {
    var parsed = JSON.parse(response);
    var income = [];
    var profit = [];
    for (var i = 0; i < parsed.length; i++) {
      var s = parsed[i][0];
      var d  = new Date(0);
      d.setUTCSeconds(s);

      if (parsed[i][1] !== null) {
        income.push([d, parsed[i][1]]);
      }
      if (parsed[i][2] !== null) {
        profit.push([d, parsed[i][2]]);
      }
    }

    console.log(profit)
    console.log(income)

    function averageAt(i, source) {
      var width = 7;
      var n = 0;
      var s = 0;
      for (var j = Math.max(0, i - width);
               j < Math.min(source.length, i + width);
               j++) {
        var weight = width - Math.abs(j - i);
        n += weight;
        s += weight*source[j][1];
      }
      return s/n;
    }

    for (var i = 0 ; i < income.length ; i++) {
      income[i].push(averageAt(i, income));
    }
    for (var i = 0 ; i < profit.length ; i++) {
      profit[i].push(averageAt(i, profit));
    }

    var income_data = new google.visualization.DataTable();
    var profit_data = new google.visualization.DataTable();

    income_data.addColumn({ type: 'date', id: 'Date' });
    profit_data.addColumn({ type: 'date', id: 'Date' });

    income_data.addColumn({ type: 'number', label: 'Income' });
    profit_data.addColumn({ type: 'number', label: 'Profit/Loss' });

    income_data.addColumn({ type: 'number', label: 'Moving Average' });
    profit_data.addColumn({ type: 'number', label: 'Moving Average' });

    income_data.addRows(income);
    profit_data.addRows(profit);

    var income_chart = new google.visualization.ScatterChart(document.getElementById('income_div'));
    var profit_chart = new google.visualization.ScatterChart(document.getElementById('profit_div'));
    
    income_chart.draw(income_data, {legend: 'top', chartArea: {'width': '80%'}});
    profit_chart.draw(profit_data, {legend: 'top', chartArea: {'width': '80%'}});
  });
});
</script>

</div>
<a href="/"><div id=back-bar>&larr; main page</div></a>

</body>
</html>
