<html><head><meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel=stylesheet href=main.css>
<title>BIDA - Attendance</title>
</head>
<body>

<div id=banner><div id=logo-wrapper><a href="/"><img src="bida_logo.gif"></a></div></div>
<div id=nav-wrapper><div id=nav><a href="/about">About</a><a href="/get-involved">Get Involved</a><a href="/safety">Safety</a><a href="/faq">FAQ</a><a href="http://blog.bidadance.org/">Blog</a></div></div>

<div id=content>

<h1>Attendance</h1>

Total attendance at our regular 1st and 3rd Sunday dances.  Includes
all attendees, including volunteers, but not including performers.
Does not include Spark in the Dark, evenings with family dances, or
other special events.

<p>

<div id="chart_div" style="width: 100%; height: 600px;"></div>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
google.load("visualization", "1", {packages:["corechart"]});
function fetch(url, callback) {
  var xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (xhr.readyState==4 && xhr.status==200) {
      callback(xhr.responseText);
    }
  };
  xhr.open("GET",url,true);
  xhr.send();
}
google.setOnLoadCallback(function () {
  fetch("/attendance.log", function(response) {
    var parsed = JSON.parse(response);

    function averageAt(i) {
      var width = 7;
      var n = 0;
      var s = 0;
      for (var j = Math.max(0, i - width);
               j < Math.min(parsed.length, i + width);
               j++) {
        var weight = width - Math.abs(j - i);
        n += weight;
        s += weight*parsed[j][1];
      }
      return s/n;
    }

    for (var i = 0 ; i < parsed.length ; i++) {
      var s = parsed[i][0];
      parsed[i][0] = new Date(0);
      parsed[i][0].setUTCSeconds(s);

      parsed[i].push(averageAt(i));
    }

    var data = new google.visualization.DataTable();
    data.addColumn({ type: 'date', id: 'Date' });
    data.addColumn({ type: 'number', label: 'Attendance' });
    data.addColumn({ type: 'number', label: 'Moving Average' });
    data.addRows(parsed);

    var chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));
    chart.draw(data, {legend: 'top', chartArea: {'width': '80%'}});
  });
});
</script>

</div>
<a href="/"><div id=back-bar>&larr; main page</div></a>

</body>
</html>
